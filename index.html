<!DOCTYPE html>
<!-- saved from url=(0057)http://webaudiodemos.appspot.com/AudioRecorder/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Audio Recorder</title>

	<script src="./js/recorderjs/recorder.js"></script>
	<style>
	html { overflow: hidden; }
	body { 
		font: 14pt Arial, sans-serif; 
		background: lightgrey;
		display: flex;
		flex-direction: column;
		height: 100vh;
		width: 100%;
		margin: 0 0;
	}
	</style>
</head>
<body>
	
    <input onclick="startRecording()" type="button" value="start recording" />
    <input onclick="stopRecording()" id="save" type="button" value="stop recording and play" />

<script>
window.AudioContext = window.AudioContext || window.webkitAudioContext;
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia ||
            navigator.mozGetUserMedia || navigator.msGetUserMedia;

var recorder = null;
var stream = null;
var audio = document.querySelector('audio');


function startRecording(){
    if (navigator.getUserMedia){
    navigator.getUserMedia({audio:true}, success, function(e) {
            alert('Error getting audio');
            console.log(e);
        });        
    }
}

function stopRecording(){
    recorder.stop();
    recorder.exportWAV(download);
}

function download(blob){
    var url = (window.URL || window.webkitURL).createObjectURL(blob);
    var link = document.getElementById("save");
    link.href = url;
    console.log("url" + url);
	console.log("link" + link);
	console.log("href" + link.href);
    link.download = 'output.wav';
}

var success = function(s){
    var context = new webkitAudioContext();
    var mediaStreamSource = context.createMediaStreamSource(s);
    recorder = new Recorder(mediaStreamSource);
    stream = s;
    recorder.record();
}

</script>
</body>

<script src = "/socket.io/socket.io.js"></script>
</html>
